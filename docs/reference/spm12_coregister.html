<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Batch SPM12 Coregister (Estimate and Reslice) — build_spm12_coregister • spm12r</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">spm12r</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/fmri_processing_spm12r.html">fMRI Preprocessing using SPM 12</a>
    </li>
    <li>
      <a href="../articles/fmri_task_processing.html">Preprocessing and First Level Model for Task fMRI</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Batch SPM12 Coregister (Estimate and Reslice)</h1>
    </div>

    
    <p>Performs SPM12 coregistration estimation and 
reslicing on an Image</p>
    

    <pre class="usage"><span class='fu'>build_spm12_coregister</span>(<span class='no'>fixed</span>, <span class='no'>moving</span>, <span class='kw'>other.files</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>cost_fun</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"nmi"</span>, <span class='st'>"ecc"</span>, <span class='st'>"ncc"</span>), <span class='kw'>separation</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>4</span>, <span class='fl'>2</span>), <span class='kw'>tol</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>0.02</span>,
  <span class='fl'>0.02</span>, <span class='fl'>0.02</span>, <span class='fl'>0.001</span>, <span class='fl'>0.001</span>, <span class='fl'>0.001</span>, <span class='fl'>0.01</span>, <span class='fl'>0.01</span>, <span class='fl'>0.01</span>, <span class='fl'>0.001</span>, <span class='fl'>0.001</span>, <span class='fl'>0.001</span>),
  <span class='kw'>fwhm</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>7</span>, <span class='fl'>7</span>), <span class='kw'>interp</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"bspline4"</span>, <span class='st'>"nearestneighbor"</span>, <span class='st'>"trilinear"</span>,
  <span class='fu'>paste0</span>(<span class='st'>"bspline"</span>, <span class='fl'>2</span>:<span class='fl'>3</span>), <span class='fu'>paste0</span>(<span class='st'>"bspline"</span>, <span class='fl'>5</span>:<span class='fl'>7</span>)), <span class='kw'>wrap_x</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>wrap_y</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>wrap_z</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>mask</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>prefix</span> <span class='kw'>=</span> <span class='st'>"r"</span>,
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>...</span>)

<span class='fu'>build_spm12_coregister_estimate</span>(<span class='no'>fixed</span>, <span class='no'>moving</span>, <span class='kw'>other.files</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>cost_fun</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"nmi"</span>, <span class='st'>"ecc"</span>, <span class='st'>"ncc"</span>), <span class='kw'>separation</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>4</span>, <span class='fl'>2</span>), <span class='kw'>tol</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>0.02</span>,
  <span class='fl'>0.02</span>, <span class='fl'>0.02</span>, <span class='fl'>0.001</span>, <span class='fl'>0.001</span>, <span class='fl'>0.001</span>, <span class='fl'>0.01</span>, <span class='fl'>0.01</span>, <span class='fl'>0.01</span>, <span class='fl'>0.001</span>, <span class='fl'>0.001</span>, <span class='fl'>0.001</span>),
  <span class='kw'>fwhm</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>7</span>, <span class='fl'>7</span>), <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>...</span>)

<span class='fu'>build_spm12_coregister_reslice</span>(<span class='no'>fixed</span>, <span class='no'>moving</span>, <span class='kw'>interp</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"bspline4"</span>,
  <span class='st'>"nearestneighbor"</span>, <span class='st'>"trilinear"</span>, <span class='fu'>paste0</span>(<span class='st'>"bspline"</span>, <span class='fl'>2</span>:<span class='fl'>3</span>), <span class='fu'>paste0</span>(<span class='st'>"bspline"</span>,
  <span class='fl'>5</span>:<span class='fl'>7</span>)), <span class='kw'>wrap_x</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>wrap_y</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>wrap_z</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>mask</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>prefix</span> <span class='kw'>=</span> <span class='st'>"r"</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>...</span>)

<span class='fu'>spm12_coregister_wrapper</span>(<span class='no'>...</span>, <span class='kw'>func</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"build_spm12_coregister"</span>,
  <span class='st'>"build_spm12_coregister_reslice"</span>, <span class='st'>"build_spm12_coregister_estimate"</span>),
  <span class='kw'>add_spm_dir</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>spmdir</span> <span class='kw'>=</span> <span class='fu'><a href='spm_dir.html'>spm_dir</a></span>(<span class='kw'>verbose</span> <span class='kw'>=</span> <span class='no'>verbose</span>), <span class='kw'>clean</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>outdir</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='fu'>spm12_coregister</span>(<span class='no'>...</span>, <span class='kw'>add_spm_dir</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>spmdir</span> <span class='kw'>=</span> <span class='fu'><a href='spm_dir.html'>spm_dir</a></span>(<span class='kw'>verbose</span> <span class='kw'>=</span>
  <span class='no'>verbose</span>), <span class='kw'>clean</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>outdir</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='fu'>spm12_coregister_estimate</span>(<span class='no'>...</span>, <span class='kw'>add_spm_dir</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>spmdir</span> <span class='kw'>=</span> <span class='fu'><a href='spm_dir.html'>spm_dir</a></span>(<span class='kw'>verbose</span>
  <span class='kw'>=</span> <span class='no'>verbose</span>), <span class='kw'>clean</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>outdir</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='fu'>spm12_coregister_reslice</span>(<span class='no'>...</span>, <span class='kw'>add_spm_dir</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>spmdir</span> <span class='kw'>=</span> <span class='fu'><a href='spm_dir.html'>spm_dir</a></span>(<span class='kw'>verbose</span> <span class='kw'>=</span>
  <span class='no'>verbose</span>), <span class='kw'>clean</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>outdir</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>fixed</th>
      <td><p>File that is assumed fixed</p></td>
    </tr>
    <tr>
      <th>moving</th>
      <td><p>moving file to be registered to fixed space</p></td>
    </tr>
    <tr>
      <th>other.files</th>
      <td><p>Other files to register to fixed, 
in same space as moving file</p></td>
    </tr>
    <tr>
      <th>cost_fun</th>
      <td><p>Cost function</p></td>
    </tr>
    <tr>
      <th>separation</th>
      <td><p>The  average  distance  between  sampled 
points (in mm).  
Can be a vector to allow a coarse registration followed by 
increasingly fine</p></td>
    </tr>
    <tr>
      <th>tol</th>
      <td><p>The  accuracy  for  each  parameter.    Iterations
stop  when 
 differences  between  successive  estimates  are  less  than  
 the required</p></td>
    </tr>
    <tr>
      <th>fwhm</th>
      <td><p>Gaussian  smoothing  to  apply  to  the 256x256 
joint histogram. 
Other information theoretic coregistration methods use fewer bins,</p></td>
    </tr>
    <tr>
      <th>interp</th>
      <td><p>Interpolator for sampling in fixed space</p></td>
    </tr>
    <tr>
      <th>wrap_x</th>
      <td><p>wrap in x-direction</p></td>
    </tr>
    <tr>
      <th>wrap_y</th>
      <td><p>wrap in y-direction</p></td>
    </tr>
    <tr>
      <th>wrap_z</th>
      <td><p>wrap in z-direction</p></td>
    </tr>
    <tr>
      <th>mask</th>
      <td><p>Mask the data.  With masking enabled, 
the program searches 
through the whole time series looking for voxels which need to
 be sampled 
from outside  the  original  images.  Where  this  occurs, 
 that  voxel is set to zero for the whole set of images</p></td>
    </tr>
    <tr>
      <th>prefix</th>
      <td><p>Prefix to append to front of image filename</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Print diagnostic messages</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments to pass to 
<code><a href='run_matlabbatch.html'>run_matlabbatch</a></code></p></td>
    </tr>
    <tr>
      <th>func</th>
      <td><p>not used</p></td>
    </tr>
    <tr>
      <th>add_spm_dir</th>
      <td><p>Add SPM12 directory from this package</p></td>
    </tr>
    <tr>
      <th>spmdir</th>
      <td><p>SPM dir to add, will use package default directory</p></td>
    </tr>
    <tr>
      <th>clean</th>
      <td><p>Remove scripts from temporary directory after running</p></td>
    </tr>
    <tr>
      <th>outdir</th>
      <td><p>Directory to copy results.  If full filename 
given, then results will
be in <code>dirname(filename)</code></p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>List of output files, the <code>matlabbatch</code> object, 
and the script</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='no'>fname</span> <span class='kw'>=</span> <span class='fu'>paste0</span>(<span class='st'>"~/Desktop/D2/scratch/"</span>,
<span class='st'>"100-318_20070723_0957_CT_3_CT_Head-_SS_0.01_SyN_ROI.nii.gz"</span>)
<span class='no'>spm</span> <span class='kw'>=</span> <span class='fu'>spm12_coregister</span>(
<span class='kw'>fixed</span> <span class='kw'>=</span> <span class='no'>fname</span>,
<span class='kw'>moving</span> <span class='kw'>=</span> <span class='no'>fname</span>,
<span class='kw'>other.files</span> <span class='kw'>=</span> <span class='no'>fname</span>,
<span class='kw'>execute</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='co'># }</span><div class='input'><span class='no'>dims</span> <span class='kw'>=</span> <span class='fu'>rep</span>(<span class='fl'>10</span>, <span class='fl'>3</span>)
<span class='no'>fixed</span> <span class='kw'>=</span> <span class='fu'>array</span>(<span class='fu'>rnorm</span>(<span class='fu'>prod</span>(<span class='no'>dims</span>)), <span class='kw'>dim</span> <span class='kw'>=</span> <span class='no'>dims</span>)
<span class='no'>fixed</span> <span class='kw'>=</span> <span class='kw pkg'>oro.nifti</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/oro.nifti/topics/nifti'>nifti</a></span>(<span class='no'>fixed</span>)
<span class='no'>moving</span> <span class='kw'>=</span> <span class='fu'>array</span>(<span class='fu'>rnorm</span>(<span class='fu'>prod</span>(<span class='no'>dims</span>)), <span class='kw'>dim</span> <span class='kw'>=</span> <span class='no'>dims</span>)
<span class='no'>moving</span> <span class='kw'>=</span> <span class='kw pkg'>oro.nifti</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/oro.nifti/topics/nifti'>nifti</a></span>(<span class='no'>moving</span>)
<span class='no'>res</span> <span class='kw'>=</span> <span class='fu'>build_spm12_coregister</span>(
<span class='kw'>fixed</span> <span class='kw'>=</span> <span class='no'>fixed</span>, <span class='kw'>moving</span> <span class='kw'>=</span> <span class='no'>moving</span>)</div><div class='output co'>#&gt; <span class='message'>Checking Filenames</span></div><div class='input'><span class='kw'>if</span> (<span class='kw pkg'>matlabr</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/matlabr/topics/have_matlab'>have_matlab</a></span>()) {
<span class='no'>run</span> <span class='kw'>=</span> <span class='fu'>spm12_coregister</span>(
   <span class='kw'>fixed</span> <span class='kw'>=</span> <span class='no'>fixed</span>, <span class='kw'>moving</span> <span class='kw'>=</span> <span class='no'>moving</span>)
}</div><div class='output co'>#&gt; cloning into '/Users/johnmuschelli/Dropbox/Packages/spm12r/inst/spm12'...
#&gt; Receiving objects:   1% (62/6142),   21 kb
#&gt; Receiving objects:  11% (676/6142),  280 kb
#&gt; Receiving objects:  21% (1290/6142),  725 kb
#&gt; Receiving objects:  31% (1905/6142), 6865 kb
#&gt; Receiving objects:  41% (2519/6142), 8274 kb
#&gt; Receiving objects:  51% (3133/6142), 14433 kb
#&gt; Receiving objects:  61% (3747/6142), 33240 kb
#&gt; Receiving objects:  71% (4361/6142), 35386 kb
#&gt; Receiving objects:  81% (4976/6142), 61305 kb
#&gt; Receiving objects:  91% (5590/6142), 69086 kb
#&gt; Receiving objects: 100% (6142/6142), 127106 kb, done.</div><div class='output co'>#&gt; <span class='message'>Checking Filenames</span></div><div class='output co'>#&gt; <span class='message'># Running matlabbatch job</span></div><div class='output co'>#&gt; <span class='message'># Creating matlabbatch job</span></div><div class='output co'>#&gt; <span class='message'># Adding SPMDIR: /Users/johnmuschelli/Dropbox/Packages/spm12r/inst/spm12\n</span></div><div class='output co'>#&gt; <span class='message'>Running job: /var/folders/1s/wrtqcpxn685_zk570bnx9_rr0000gr/T//RtmpsLtBgJ/filedf89306f2c92.m, which calls /var/folders/1s/wrtqcpxn685_zk570bnx9_rr0000gr/T//RtmpsLtBgJ/filedf894e9b37d7.m</span></div><div class='output co'>#&gt; <span class='message'>Command run is:</span></div><div class='output co'>#&gt; <span class='message'>matlab -nodesktop -nosplash -nodisplay -r  "try, run('/var/folders/1s/wrtqcpxn685_zk570bnx9_rr0000gr/T//RtmpsLtBgJ/filedf89306f2c92.m'); catch err, disp(err.message); exit(1); end; exit(0);"</span></div><div class='output co'>#&gt; <span class='message'># Result is 0</span></div><div class='output co'>#&gt; <span class='message'># Removing scripts</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by John Muschelli.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
